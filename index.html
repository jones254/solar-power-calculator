<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Match Predictor</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #f8f9fa;
            --border-color: #dee2e6;
            --text-color: #333;
            --light-text: #6c757d;
            --background-color: #f0f2f5;
            --card-bg: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
        }

        header h1 {
            color: var(--primary-color);
            font-size: 28px;
            margin: 0;
        }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 20px;
        }

        .team-box, .odds-box {
            background-color: var(--secondary-color);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .odds-box {
            grid-column: 1 / -1;
        }

        .team-box h2, .odds-box h2 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 20px;
            text-align: center;
            color: var(--text-color);
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--light-text);
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
        }

        #predictBtn {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            background-color: var(--primary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #predictBtn:hover {
            background-color: #0056b3;
        }

        #results-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .result-card {
            background: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-card h3 {
            margin-top: 0;
            text-align: center;
            color: var(--primary-color);
        }

        #wagering-advice {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap; /* Handles multiple lines */
            line-height: 1.6;
        }

        .advice-avoid {
            background-color: #ffc107;
            color: #333;
        }

        .advice-bet {
            background-color: #28a745;
            color: white;
        }

        .probabilities-grid, .stats-grid {
            display: grid;
            gap: 15px;
            text-align: center;
        }

        .probabilities-grid { grid-template-columns: repeat(3, 1fr); }
        .stats-grid { grid-template-columns: repeat(2, 1fr); }

        .prob-item, .stat-item {
            padding: 10px;
        }

        .prob-item .label, .stat-item .label {
            font-size: 14px;
            color: var(--light-text);
        }

        .prob-item .value, .stat-item .value {
            font-size: 24px;
            font-weight: bold;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .breakdown-item:last-child {
            border-bottom: none;
        }

        .breakdown-item .model-name {
            font-weight: 500;
        }

        .breakdown-item .model-probs {
            font-family: monospace;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 600px) {
            .input-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>⚽ Football Match Predictor</h1>
        </header>

        <div class="input-grid">
            <div class="team-box">
                <h2>Home Team</h2>
                <div class="form-group">
                    <label for="home_avg_score">Average Scored</label>
                    <input type="number" id="home_avg_score" step="0.01" value="1.56">
                </div>
                <div class="form-group">
                    <label for="home_avg_conceded">Average Conceded</label>
                    <input type="number" id="home_avg_conceded" step="0.01" value="0.97">
                </div>
                <div class="form-group">
                    <label for="home_score_percentage">Scoring Percentage (%)</label>
                    <input type="number" id="home_score_percentage" step="1" value="88">
                </div>
                <div class="form-group">
                    <label for="home_cleansheet">Clean Sheet (%)</label>
                    <input type="number" id="home_cleansheet" step="1" value="47">
                </div>
                <div class="form-group">
                    <label for="home_difficulty">Difficulty (1-5)</label>
                    <input type="number" id="home_difficulty" step="1" min="1" max="5" value="4">
                </div>
            </div>

            <div class="team-box">
                <h2>Away Team</h2>
                <div class="form-group">
                    <label for="away_avg_score">Average Scored</label>
                    <input type="number" id="away_avg_score" step="0.01" value="0.68">
                </div>
                <div class="form-group">
                    <label for="away_avg_conceded">Average Conceded</label>
                    <input type="number" id="away_avg_conceded" step="0.01" value="1.15">
                </div>
                <div class="form-group">
                    <label for="away_score_percentage">Scoring Percentage (%)</label>
                    <input type="number" id="away_score_percentage" step="1" value="56">
                </div>
                <div class="form-group">
                    <label for="away_cleansheet">Clean Sheet (%)</label>
                    <input type="number" id="away_cleansheet" step="1" value="35">
                </div>
                <div class="form-group">
                    <label for="away_difficulty">Difficulty (1-5)</label>
                    <input type="number" id="away_difficulty" step="1" min="1" max="5" value="2">
                </div>
            </div>

            <div class="odds-box">
                <h2>Match Odds</h2>
                 <div class="probabilities-grid">
                    <div class="form-group">
                        <label for="home_odds">Home Win Odds</label>
                        <input type="number" id="home_odds" step="0.01" value="1.6">
                    </div>
                    <div class="form-group">
                        <label for="draw_odds">Draw Odds</label>
                        <input type="number" id="draw_odds" step="0.01" value="3.9">
                    </div>
                    <div class="form-group">
                        <label for="away_odds">Away Win Odds</label>
                        <input type="number" id="away_odds" step="0.01" value="5.5">
                    </div>
                </div>
            </div>
        </div>

        <button id="predictBtn">🔮 Predict Match</button>

        <div id="results-section" class="hidden">
            <div class="result-card">
                 <h3>🧠 Wagering Advice</h3>
                 <div id="wagering-advice"></div>
            </div>

            <div class="result-card">
                <h3>📊 Prediction Analysis</h3>
                <p style="text-align:center; color: var(--light-text);">Predicted Outcome: <strong id="predicted-outcome">Home Win</strong> with <strong id="confidence-level">0.0%</strong> confidence.</p>

                <h4>📊 Final Probabilities:</h4>
                <div class="probabilities-grid">
                    <div class="prob-item">
                        <div class="label">Home Win</div>
                        <div class="value" id="final-prob-home">0.0%</div>
                    </div>
                    <div class="prob-item">
                        <div class="label">Draw</div>
                        <div class="value" id="final-prob-draw">0.0%</div>
                    </div>
                    <div class="prob-item">
                        <div class="label">Away Win</div>
                        <div class="value" id="final-prob-away">0.0%</div>
                    </div>
                </div>

                <h4>⚽ Expected Goals:</h4>
                 <div class="stats-grid">
                     <div class="stat-item">
                         <div class="label">Home Team</div>
                         <div class="value" id="expected-goals-home">0.00</div>
                     </div>
                     <div class="stat-item">
                         <div class="label">Away Team</div>
                         <div class="value" id="expected-goals-away">0.00</div>
                     </div>
                 </div>

                <h4>🏆 Team Quality Scores:</h4>
                 <div class="stats-grid">
                     <div class="stat-item">
                         <div class="label">Home Team</div>
                         <div class="value" id="quality-score-home">0.00</div>
                     </div>
                     <div class="stat-item">
                         <div class="label">Away Team</div>
                         <div class="value" id="quality-score-away">0.00</div>
                     </div>
                 </div>

                <h4>🎯 Quality-Adjusted Poisson:</h4>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="label">H-Check</div>
                        <div class="value" id="q-poisson-hcheck">0.00</div>
                    </div>
                    <div class="stat-item">
                        <div class="label">A-Check</div>
                        <div class="value" id="q-poisson-acheck">0.00</div>
                    </div>
                </div>
                <div class="probabilities-grid">
                    <div class="prob-item">
                        <div class="label">Home Win</div>
                        <div class="value" id="q-prob-home">0.0%</div>
                    </div>
                    <div class="prob-item">
                        <div class="label">Draw</div>
                        <div class="value" id="q-prob-draw">0.0%</div>
                    </div>
                    <div class="prob-item">
                        <div class="label">Away Win</div>
                        <div class="value" id="q-prob-away">0.0%</div>
                    </div>
                </div>

                <h4 style="margin-top: 25px;">🔍 Model Breakdown:</h4>
                <div class="breakdown-grid">
                    <div id="breakdown-poisson" class="breakdown-item"></div>
                    <div id="breakdown-form_based" class="breakdown-item"></div>
                    <div id="breakdown-defensive_strength" class="breakdown-item"></div>
                    <div id="breakdown-market_sentiment" class="breakdown-item"></div>
                    <div id="breakdown-composite_rating" class="breakdown-item"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class FootballPredictor {
            constructor() {
                this.weights = { 'poisson': 0.25, 'form_based': 0.20, 'defensive_strength': 0.15, 'market_sentiment': 0.20, 'composite_rating': 0.20 }; // [cite: 2]
                this.factorialCache = {0: 1};
            }

            _factorial(n) {
                if (n in this.factorialCache) return this.factorialCache[n];
                if (n < 0) return NaN;
                if (n === 0) return 1;
                let result = 1;
                for (let i = 2; i <= n; i++) { result *= i; }
                this.factorialCache[n] = result;
                return result;
            }

            _poissonProb(k, lam) { // [cite: 3]
                if (lam <= 0) return k === 0 ? 1.0 : 0.0; // [cite: 3]
                // Using Math.pow for exponentiation and Math.exp for e^x
                return (Math.pow(lam, k) * Math.exp(-lam)) / this._factorial(k); // [cite: 3]
            }

            calculatePoissonProbabilities(matchData) { // [cite: 3]
                const homeAttackStrength = matchData.home_avg_score * (6 - matchData.away_difficulty) / 5; // [cite: 4]
                const awayAttackStrength = matchData.away_avg_score * (6 - matchData.home_difficulty) / 5; // [cite: 4]
                const homeDefenseStrength = matchData.home_avg_conceded * (matchData.away_difficulty / 5); // [cite: 4]
                const awayDefenseStrength = matchData.away_avg_conceded * (matchData.home_difficulty / 5); // [cite: 4]
                const homeExpectedGoals = (homeAttackStrength + awayDefenseStrength) / 2; // [cite: 4]
                const awayExpectedGoals = (awayAttackStrength + homeDefenseStrength) / 2; // [cite: 4]

                const maxGoals = 4; // [cite: 5]
                let homeWin = 0, draw = 0, awayWin = 0;
                // Simpler loop structure
                for (let h = 0; h <= maxGoals; h++) { // [cite: 5]
                    for (let a = 0; a <= maxGoals; a++) { // [cite: 5]
                        const prob_h = this._poissonProb(h, homeExpectedGoals); // [cite: 5]
                        const prob_a = this._poissonProb(a, awayExpectedGoals); // [cite: 5]
                        const cellProb = prob_h * prob_a; // [cite: 6]
                        if (h > a) homeWin += cellProb; // [cite: 6]
                        else if (h === a) draw += cellProb; // [cite: 6, 7]
                        else awayWin += cellProb; // [cite: 7]
                    }
                }
                return { home_win: homeWin, draw: draw, away_win: awayWin, expected_goals: { home: homeExpectedGoals, away: awayExpectedGoals } }; // [cite: 7, 8]
            }

            calculatePoissonForQuality(hcheck, acheck) { // [cite: 8]
                const maxGoals = 4; // [cite: 8]
                let homeWin = 0, draw = 0, awayWin = 0;
                // Simpler loop structure
                for (let h = 0; h <= maxGoals; h++) { // [cite: 9]
                    for (let a = 0; a <= maxGoals; a++) { // [cite: 9]
                        const prob_h = this._poissonProb(h, hcheck); // [cite: 9]
                        const prob_a = this._poissonProb(a, acheck); // [cite: 9]
                        const cellProb = prob_h * prob_a; // [cite: 9]
                        if (h > a) homeWin += cellProb; // [cite: 10]
                        else if (h === a) draw += cellProb; // [cite: 10]
                        else awayWin += cellProb; // [cite: 11]
                    }
                }
                // Return raw values, rounding happens later if needed
                return { home_win: homeWin, draw: draw, away_win: awayWin }; // [cite: 11]
            }

            calculateFormBasedPrediction(matchData) { // [cite: 12]
                let homeForm = matchData.home_score_percentage / 100.0; // [cite: 12]
                let awayForm = matchData.away_score_percentage / 100.0; // [cite: 12]
                const totalForm = homeForm + awayForm; // [cite: 12]
                let homeFormAdvantage, awayFormAdvantage;
                if (totalForm > 0) { // [cite: 12]
                    homeFormAdvantage = homeForm / totalForm; // [cite: 12]
                    awayFormAdvantage = awayForm / totalForm; // [cite: 12]
                } else {
                    homeFormAdvantage = awayFormAdvantage = 0.5; // [cite: 13]
                }
                homeFormAdvantage += 0.07; // [cite: 13]
                const formSum = homeFormAdvantage + awayFormAdvantage; // [cite: 13]
                homeFormAdvantage /= formSum; // [cite: 13]
                awayFormAdvantage /= formSum; // [cite: 13]
                const formDifference = Math.abs(homeFormAdvantage - awayFormAdvantage); // [cite: 13]
                let drawProb = 0.35 - (formDifference * 0.2); // [cite: 13]
                drawProb = Math.max(0.15, Math.min(0.45, drawProb)); // [cite: 13]
                const remainingProb = 1.0 - drawProb; // [cite: 14]
                return { home_win: homeFormAdvantage * remainingProb, draw: drawProb, away_win: awayFormAdvantage * remainingProb }; // [cite: 14]
            }

            calculateDefensiveStrengthModel(matchData) { // [cite: 14]
                const homeDefenseRating = (matchData.home_cleansheet / 100.0) * (1 / Math.max(0.1, matchData.home_avg_conceded)); // [cite: 14]
                const awayDefenseRating = (matchData.away_cleansheet / 100.0) * (1 / Math.max(0.1, matchData.away_avg_conceded)); // [cite: 15]
                const homeAttackVsAwayDefense = matchData.home_avg_score / Math.max(0.1, matchData.away_avg_conceded); // [cite: 15]
                const awayAttackVsHomeDefense = matchData.away_avg_score / Math.max(0.1, matchData.home_avg_conceded); // [cite: 15]
                const totalAttackRatio = homeAttackVsAwayDefense + awayAttackVsHomeDefense; // [cite: 15]
                let homeAttackNorm, awayAttackNorm;
                if (totalAttackRatio > 0) { // [cite: 15]
                    homeAttackNorm = homeAttackVsAwayDefense / totalAttackRatio; // [cite: 15]
                    awayAttackNorm = awayAttackVsHomeDefense / totalAttackRatio; // [cite: 15]
                } else {
                    homeAttackNorm = awayAttackNorm = 0.5; // [cite: 16]
                }
                const avgDefenseStrength = (homeDefenseRating + awayDefenseRating) / 2; // [cite: 16]
                const drawBoost = Math.min(0.15, avgDefenseStrength * 0.3); // [cite: 16]
                const baseDraw = 0.25 + drawBoost; // [cite: 16]
                const remainingProb = 1.0 - baseDraw; // [cite: 16]
                return { home_win: homeAttackNorm * remainingProb, draw: baseDraw, away_win: awayAttackNorm * remainingProb }; // [cite: 16, 17]
            }

            calculateMarketSentimentModel(matchData) { // [cite: 17]
                const homeImplied = 1 / matchData.home_odds; // [cite: 17]
                const drawImplied = 1 / matchData.draw_odds; // [cite: 17]
                const awayImplied = 1 / matchData.away_odds; // [cite: 17]
                const totalImplied = homeImplied + drawImplied + awayImplied; // [cite: 17]
                const homeProb = homeImplied / totalImplied; // [cite: 17, 18]
                const drawProb = drawImplied / totalImplied; // [cite: 18]
                const awayProb = awayImplied / totalImplied; // [cite: 18]
                return { home_win: homeProb, draw: drawProb, away_win: awayProb }; // [cite: 18]
            }

            calculateCompositeRatingModel(matchData) { // [cite: 18]
                const homeQuality = (matchData.home_avg_score * 0.3) + ((1 / Math.max(0.1, matchData.home_avg_conceded)) * 0.2) + ((matchData.home_score_percentage / 100) * 0.25) + ((matchData.home_cleansheet / 100) * 0.15) + (((6 - matchData.home_difficulty) / 5) * 0.1); // [cite: 18, 19]
                const awayQuality = (matchData.away_avg_score * 0.3) + ((1 / Math.max(0.1, matchData.away_avg_conceded)) * 0.2) + ((matchData.away_score_percentage / 100) * 0.25) + ((matchData.away_cleansheet / 100) * 0.15) + (((6 - matchData.away_difficulty) / 5) * 0.1); // [cite: 19, 20]
                const qualityDiff = homeQuality - awayQuality; // [cite: 21]
                const qualitySum = homeQuality + awayQuality; // [cite: 21]
                let homeBaseProb, awayBaseProb;
                if (qualitySum > 0) { // [cite: 21]
                    // Using Math.exp for e^x
                    homeBaseProb = 1 / (1 + Math.exp(-qualityDiff * 3)); // [cite: 21, 22]
                    awayBaseProb = 1 - homeBaseProb; // [cite: 22]
                } else {
                    homeBaseProb = awayBaseProb = 0.5; // [cite: 22]
                }
                // Using Math.sqrt for square root
                const contextFactor = Math.sqrt(homeQuality * awayQuality); // [cite: 22]
                let drawProb = 0.2 + (contextFactor * 0.15); // [cite: 22]
                drawProb = Math.min(0.4, drawProb); // [cite: 22]
                const remaining = 1.0 - drawProb; // [cite: 22]
                const home_win_prob = homeBaseProb * remaining; // [cite: 22, 23]
                const away_win_prob = awayBaseProb * remaining; // [cite: 23]
                return { home_win: home_win_prob, draw: drawProb, away_win: away_win_prob, home_quality: homeQuality, away_quality: awayQuality }; // [cite: 23]
            }

            predictMatch(matchData) { // [cite: 23]
                const models = {
                    poisson: this.calculatePoissonProbabilities(matchData), // [cite: 23]
                    form_based: this.calculateFormBasedPrediction(matchData), // [cite: 23]
                    defensive_strength: this.calculateDefensiveStrengthModel(matchData), // [cite: 23]
                    market_sentiment: this.calculateMarketSentimentModel(matchData), // [cite: 23]
                    composite_rating: this.calculateCompositeRatingModel(matchData) // [cite: 24]
                };

                const hcheck = (models.poisson.expected_goals.home + models.composite_rating.home_quality) / 2; // [cite: 24]
                const acheck = (models.poisson.expected_goals.away + models.composite_rating.away_quality) / 2; // [cite: 24]
                const qualityPoissonRaw = this.calculatePoissonForQuality(hcheck, acheck); // [cite: 24, 25]

                let finalHome = 0, finalDraw = 0, finalAway = 0;
                for (const modelName in this.weights) {
                    finalHome += models[modelName]['home_win'] * this.weights[modelName]; // [cite: 24, 25]
                    finalDraw += models[modelName]['draw'] * this.weights[modelName]; // [cite: 25, 26]
                    finalAway += models[modelName]['away_win'] * this.weights[modelName]; // [cite: 26, 27]
                }

                const total = finalHome + finalDraw + finalAway; // [cite: 28]
                finalHome /= total; // [cite: 28]
                finalDraw /= total; // [cite: 28]
                finalAway /= total; // [cite: 28]

                const maxProb = Math.max(finalHome, finalDraw, finalAway); // [cite: 28]
                let predictedOutcome; // Use string directly
                if (maxProb === finalHome) predictedOutcome = "Home Win"; // [cite: 28]
                else if (maxProb === finalDraw) predictedOutcome = "Draw"; // [cite: 28]
                else predictedOutcome = "Away Win"; // [cite: 29]

                const probs = [finalHome, finalDraw, finalAway]; // [cite: 29]
                // Using Math.log for natural logarithm
                const entropy = -probs.reduce((sum, p) => sum + p * Math.log(p + 1e-10), 0); // [cite: 29]
                const max_entropy = Math.log(3); // [cite: 29]
                const confidence = 1 - (entropy / max_entropy); // [cite: 29]

                // Rounding directly in the return object for clarity
                return { // [cite: 29]
                    predicted_outcome: predictedOutcome,
                    probabilities: { // [cite: 30]
                        home_win: parseFloat(finalHome.toFixed(4)), // [cite: 30]
                        draw: parseFloat(finalDraw.toFixed(4)), // [cite: 30]
                        away_win: parseFloat(finalAway.toFixed(4)) // [cite: 30]
                    },
                    confidence: parseFloat(confidence.toFixed(4)), // [cite: 30]
                    expected_goals: models.poisson.expected_goals, // [cite: 31]
                    model_breakdown: { // [cite: 31]
                        poisson: { home_win: parseFloat(models.poisson.home_win.toFixed(4)), draw: parseFloat(models.poisson.draw.toFixed(4)), away_win: parseFloat(models.poisson.away_win.toFixed(4)) }, // [cite: 31]
                        form_based: { home_win: parseFloat(models.form_based.home_win.toFixed(4)), draw: parseFloat(models.form_based.draw.toFixed(4)), away_win: parseFloat(models.form_based.away_win.toFixed(4)) }, // [cite: 32]
                        defensive_strength: { home_win: parseFloat(models.defensive_strength.home_win.toFixed(4)), draw: parseFloat(models.defensive_strength.draw.toFixed(4)), away_win: parseFloat(models.defensive_strength.away_win.toFixed(4)) }, // [cite: 33]
                        market_sentiment: { home_win: parseFloat(models.market_sentiment.home_win.toFixed(4)), draw: parseFloat(models.market_sentiment.draw.toFixed(4)), away_win: parseFloat(models.market_sentiment.away_win.toFixed(4)) }, // [cite: 34]
                        composite_rating: { home_win: parseFloat(models.composite_rating.home_win.toFixed(4)), draw: parseFloat(models.composite_rating.draw.toFixed(4)), away_win: parseFloat(models.composite_rating.away_win.toFixed(4)) } // [cite: 35]
                    },
                    team_quality_scores: { // [cite: 36]
                        home: parseFloat(models.composite_rating.home_quality.toFixed(4)), // [cite: 36]
                        away: parseFloat(models.composite_rating.away_quality.toFixed(4)) // [cite: 36]
                    },
                    quality_poisson: { // [cite: 36]
                        // Note: Python rounds poisson_for_quality internally, JS does not. Applying rounding here.
                        home_win: parseFloat(qualityPoissonRaw.home_win.toFixed(4)), // [cite: 37, 11]
                        draw: parseFloat(qualityPoissonRaw.draw.toFixed(4)), // [cite: 37, 11]
                        away_win: parseFloat(qualityPoissonRaw.away_win.toFixed(4)), // [cite: 37, 11]
                        hcheck: parseFloat(hcheck.toFixed(3)), // [cite: 37]
                        acheck: parseFloat(acheck.toFixed(3)) // [cite: 37]
                    }
                };
            }
        }

        // *** UPDATED based on the new multi-part wagering advice logic ***
        function getWageringAdvice(prediction) { // [cite: 41]
            const finalProbs = prediction.probabilities; // [cite: 41]
            const poissonProbs = prediction.model_breakdown.poisson; // [cite: 41]
            const compositeProbs = prediction.model_breakdown.composite_rating; // [cite: 41]
            const formProbs = prediction.model_breakdown.form_based; // [cite: 41]
            const defenseProbs = prediction.model_breakdown.defensive_strength; // [cite: 41]
            const marketProbs = prediction.model_breakdown.market_sentiment; // [cite: 41]
            const qp = prediction.quality_poisson; // [cite: 40]

            let adviceLines = [];

            // Define all variables from the Python script
            const h_odd = defenseProbs.home_win - defenseProbs.draw; // [cite: 42]
            const h_hub = formProbs.home_win - defenseProbs.away_win > formProbs.away_win - defenseProbs.home_win; // [cite: 42]
            const a_aub = formProbs.home_win - defenseProbs.away_win < formProbs.away_win - defenseProbs.home_win; // [cite: 42]
            const a_odd = defenseProbs.away_win - defenseProbs.draw; // [cite: 42]
            const acheck = (compositeProbs.away_win - compositeProbs.draw) > (marketProbs.home_win - marketProbs.draw); // [cite: 42]
            const hcheck = (compositeProbs.home_win - compositeProbs.draw) > (marketProbs.away_win - marketProbs.draw); // [cite: 42]
            const htry = parseFloat((((marketProbs.home_win + compositeProbs.home_win) - poissonProbs.home_win) / poissonProbs.home_win * 100).toFixed(1)); // [cite: 42]
            const atry = parseFloat((((marketProbs.away_win + compositeProbs.away_win) - poissonProbs.away_win) / poissonProbs.away_win * 100).toFixed(1)); // [cite: 42, 43]
            const htip = compositeProbs.home_win > compositeProbs.away_win; // [cite: 43]
            const atip = compositeProbs.away_win > compositeProbs.home_win; // [cite: 43]
            const ho = qp.home_win - compositeProbs.home_win; // [cite: 43]
            const awa = qp.away_win - compositeProbs.away_win; // [cite: 43]
            const hub = formProbs.home_win - defenseProbs.home_win > formProbs.away_win - defenseProbs.away_win; // [cite: 43]
            const aub = formProbs.home_win - defenseProbs.home_win < formProbs.away_win - defenseProbs.away_win; // [cite: 43]
            const hbet = (defenseProbs.away_win * 100 - parseFloat((finalProbs.home_win * 100 - formProbs.home_win * 100).toFixed(1))) > defenseProbs.home_win * 100; // [cite: 43, 44]
            const abet = (defenseProbs.home_win * 100 - parseFloat((finalProbs.away_win * 100 - formProbs.away_win * 100).toFixed(1))) > defenseProbs.away_win * 100; // [cite: 44]
            const hbee = (marketProbs.home_win > marketProbs.away_win || marketProbs.home_win > compositeProbs.home_win) && (marketProbs.home_win > qp.home_win); // [cite: 44]
            const abee = (marketProbs.home_win < marketProbs.away_win || marketProbs.away_win > compositeProbs.away_win) && (marketProbs.away_win > qp.away_win); // [cite: 44]


            // Block 1: Try Bet Advice (using h_hub, a_aub)
            if (h_hub && defenseProbs.away_win < defenseProbs.draw) { // [cite: 45]
                adviceLines.push(`TRY HOME WIN         super ${compositeProbs.away_win < compositeProbs.draw}`); // [cite: 45]
            } else if (a_aub && defenseProbs.home_win < defenseProbs.draw) { // [cite: 45]
                adviceLines.push(`TRY AWAY WIN         super ${compositeProbs.home_win < compositeProbs.draw}`); // [cite: 45]
            } else if (h_hub) { // [cite: 45]
                adviceLines.push(`TRY HOME - DRAW       super ${compositeProbs.away_win < compositeProbs.draw}`); // [cite: 45]
            } else if (a_aub) { // [cite: 45, 46]
                adviceLines.push(`TRY AWAY - DRAW          super ${compositeProbs.home_win < compositeProbs.draw}`); // [cite: 46]
            }

            // Block 2: Main Bet Advice
            if (ho > awa && aub && atry < htry && !abee) { // [cite: 46]
                adviceLines.push('H-O-M-E__W-I-N'); // [cite: 46]
            } else if (ho > awa && aub && atry < htry && abee && htry < atry && (marketProbs.home_win + compositeProbs.home_win) > (marketProbs.away_win + compositeProbs.away_win) && h_odd > a_odd) { // [cite: 46, 47]
                adviceLines.push('HOME'); // [cite: 47]
            } else if (ho > awa && aub && atry < htry && abee) { // [cite: 47]
                adviceLines.push('AWAY-DRAW'); // [cite: 47]
            } else if (ho < awa && hub && htry < atry && !hbee) { // [cite: 47]
                adviceLines.push('A-W-A-Y__W-I-N'); // [cite: 47]
            } else if (ho < awa && hub && htry < atry && hbee && htry > atry && (marketProbs.home_win + compositeProbs.home_win) < (marketProbs.away_win + compositeProbs.away_win) && h_odd < a_odd) { // [cite: 47, 48]
                adviceLines.push('AWAY'); // [cite: 48]
            } else if (ho < awa && hub && htry < atry && hbee) { // [cite: 48]
                adviceLines.push('HOME-DRAW'); // [cite: 48]
            } else if (ho > awa && aub && atry > htry && abee && ho > awa && htry < atry && h_odd > a_odd) { // [cite: 48]
                adviceLines.push(`HOME-DNB ----W   ${htip} ${hcheck}`); // [cite: 48]
            } else if (ho > awa && aub && atry > htry && abee) { // [cite: 48, 49]
                adviceLines.push('H-O-M-E__D-N-B'); // [cite: 49]
            } else if (ho < awa && hub && htry > atry && hbee && ho < awa && htry > atry && h_odd < a_odd) { // [cite: 49]
                adviceLines.push(`AWAY-DNB -----W   ${atip} ${acheck}`); // [cite: 49]
            } else if (ho < awa && hub && htry > atry && hbee) { // [cite: 49]
                adviceLines.push('A-W-A-Y__D-N-B'); // [cite: 49]
            } else if (ho > awa && hub && atry > htry && hbee && hbet && compositeProbs.home_win > compositeProbs.away_win) { // [cite: 49, 50]
                adviceLines.push('H->O->M->E--->W->I->N'); // [cite: 50]
            } else if (ho > awa && hub && atry > htry && hbet && marketProbs.home_win < compositeProbs.home_win) { // [cite: 50]
                adviceLines.push('H->O->M->E--->D->R->A->W'); // [cite: 50]
            } else if (ho < awa && aub && atry < htry && abee && abet && compositeProbs.home_win < compositeProbs.away_win) { // [cite: 50]
                adviceLines.push('A->W->A->Y--->W->I->N'); // [cite: 50]
            } else if (ho < awa && aub && atry < htry && abet && marketProbs.away_win < compositeProbs.away_win) { // [cite: 50]
                adviceLines.push('A->W->A->Y--->D->R->A->Y'); // [cite: 50]
            } else {
                adviceLines.push('AVOID'); // [cite: 51]
            }

            return adviceLines.join('\n\n'); // Separate advice blocks with double newline
        }

        document.getElementById('predictBtn').addEventListener('click', () => {
            try {
                const matchData = {
                    home_avg_score: parseFloat(document.getElementById('home_avg_score').value), // [cite: 1]
                    away_avg_score: parseFloat(document.getElementById('away_avg_score').value), // [cite: 1]
                    home_avg_conceded: parseFloat(document.getElementById('home_avg_conceded').value), // [cite: 1]
                    away_avg_conceded: parseFloat(document.getElementById('away_avg_conceded').value), // [cite: 1]
                    home_score_percentage: parseFloat(document.getElementById('home_score_percentage').value), // [cite: 1]
                    away_score_percentage: parseFloat(document.getElementById('away_score_percentage').value), // [cite: 1]
                    home_cleansheet: parseFloat(document.getElementById('home_cleansheet').value), // [cite: 1]
                    away_cleansheet: parseFloat(document.getElementById('away_cleansheet').value), // [cite: 1]
                    home_difficulty: parseInt(document.getElementById('home_difficulty').value), // [cite: 1]
                    away_difficulty: parseInt(document.getElementById('away_difficulty').value), // [cite: 1]
                    home_odds: parseFloat(document.getElementById('home_odds').value), // [cite: 1]
                    draw_odds: parseFloat(document.getElementById('draw_odds').value), // [cite: 1]
                    away_odds: parseFloat(document.getElementById('away_odds').value) // [cite: 2]
                };

                // Input validation
                for (const key in matchData) {
                     if (isNaN(matchData[key])) {
                         alert(`Please enter a valid number for ${key.replace(/_/g, ' ')}.`);
                         return;
                     }
                 }

                const predictor = new FootballPredictor(); // [cite: 39]
                const prediction = predictor.predictMatch(matchData); // [cite: 39]
                const advice = getWageringAdvice(prediction); // Generate advice using the prediction results

                // Display results
                document.getElementById('results-section').classList.remove('hidden');

                const adviceDiv = document.getElementById('wagering-advice');
                adviceDiv.textContent = advice;
                // Basic check for coloring based on 'AVOID'
                adviceDiv.className = advice.includes('AVOID') ? 'advice-avoid' : 'advice-bet';

                document.getElementById('predicted-outcome').textContent = prediction.predicted_outcome; // [cite: 29]
                document.getElementById('confidence-level').textContent = (prediction.confidence * 100).toFixed(1) + '%'; // [cite: 30]

                document.getElementById('final-prob-home').textContent = (prediction.probabilities.home_win * 100).toFixed(1) + '%'; // [cite: 30]
                document.getElementById('final-prob-draw').textContent = (prediction.probabilities.draw * 100).toFixed(1) + '%'; // [cite: 30]
                document.getElementById('final-prob-away').textContent = (prediction.probabilities.away_win * 100).toFixed(1) + '%'; // [cite: 30]

                document.getElementById('expected-goals-home').textContent = prediction.expected_goals.home.toFixed(2); // [cite: 31]
                document.getElementById('expected-goals-away').textContent = prediction.expected_goals.away.toFixed(2); // [cite: 31]

                document.getElementById('quality-score-home').textContent = prediction.team_quality_scores.home.toFixed(3); // [cite: 36]
                document.getElementById('quality-score-away').textContent = prediction.team_quality_scores.away.toFixed(3); // [cite: 36]

                const qp = prediction.quality_poisson; // [cite: 40]
                document.getElementById('q-poisson-hcheck').textContent = qp.hcheck.toFixed(3); // [cite: 37]
                document.getElementById('q-poisson-acheck').textContent = qp.acheck.toFixed(3); // [cite: 37]
                document.getElementById('q-prob-home').textContent = (qp.home_win * 100).toFixed(1) + '%'; // [cite: 37]
                document.getElementById('q-prob-draw').textContent = (qp.draw * 100).toFixed(1) + '%'; // [cite: 37]
                document.getElementById('q-prob-away').textContent = (qp.away_win * 100).toFixed(1) + '%'; // [cite: 37]

                // Display model breakdown
                for(const modelName in prediction.model_breakdown) { // [cite: 41]
                    const probs = prediction.model_breakdown[modelName]; // [cite: 41]
                    const cleanName = modelName.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()); // [cite: 41]
                    document.getElementById(`breakdown-${modelName}`).innerHTML = `<span class="model-name">${cleanName}</span><span class="model-probs">H: ${(probs.home_win * 100).toFixed(1)}% | D: ${(probs.draw * 100).toFixed(1)}% | A: ${(probs.away_win * 100).toFixed(1)}%</span>`; // [cite: 41]
                }
            } catch (error) {
                console.error("An error occurred during prediction:", error);
                alert("An error occurred. Please check the console for details and ensure all inputs are valid.");
            }
        });
    </script>
</body>
    </html>
